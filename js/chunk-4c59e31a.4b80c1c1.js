(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c59e31a"],{1471:function(s,a,e){"use strict";e("90aa8")},"90aa8":function(s,a,e){},a4f2:function(s,a,e){"use strict";e.r(a);var t=function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"app1"},[e("div"),e("div",{staticClass:"session"},[e("div",{staticClass:"left"},[e("div",{staticClass:"search"},[e("a-input-search",{staticStyle:{width:"100%"},attrs:{placeholder:"input search text"},on:{search:s.onSearch}})],1),e("vue-scroll",{attrs:{ops:s.ops}},[e("div",{staticClass:"session-list"},[e("ul",s._l(s.sessionList,(function(a,t){return e("li",{key:t,class:a.id==s.checkSession.id?"checked":"",attrs:{index:t,item:a},on:{click:function(e){return e.stopPropagation(),s.checkUser(a)}}},[e("div",{staticClass:"user-avatar"},[null!=a.avatar?e("a-avatar",{staticClass:"avatar",attrs:{size:50,src:a.avatar}}):e("a-avatar",{staticClass:"avatar",staticStyle:{color:"#f56a00",backgroundColor:"#fde3cf"},attrs:{size:50}},[s._v(" "+s._s(a.userName)+" ")])],1),e("div",{staticClass:"info"},[e("div",{staticClass:"text"},[e("div",{staticClass:"name"},[s._v(" "+s._s(a.userName)+" ")]),e("div",[s._v(" "+s._s(a.message)+" ")])]),e("div",{staticClass:"about"},[e("div",{staticClass:"time"},[s._v(" "+s._s(a.createTime)+" ")]),a.num>0?e("div",{staticClass:"num"},[s._v(" "+s._s(a.num)+" ")]):s._e()])])])})),0)])])],1),e("div",{staticClass:"right"},[null==s.checkSession.id||void 0===s.checkSession.id?e("div",{staticClass:"empty"},[e("a-empty",[e("span",{attrs:{slot:"description"},slot:"description"},[s._v(" 未选中聊天会话 ")])])],1):s._e(),null!=s.checkSession.id&&void 0!==s.checkSession.id?e("div",{staticClass:"chat"},[e("div",{staticClass:"title"},[e("div",[s._v(" "+s._s(s.checkSession.userName)+" ")]),e("div",[s._v(" "+s._s(s.checkSession.positionName)+" ")])]),e("vue-scroll",{ref:"chatList",attrs:{ops:s.ops},on:{"handle-scroll":s.chatHandleScroll}},[e("div",{staticClass:"loading"}),e("div",{staticClass:"chat-list",attrs:{id:"chat-list"}},s._l(s.chatList,(function(a,t){return e("div",{key:t,staticClass:"chat-item",class:a.userId==s.myId?"me":"target",attrs:{index:t,item:a}},[a.userId!=s.myId?e("div",{staticClass:"avatar"},[null!=a.avatar?e("a-avatar",{staticClass:"avatar",attrs:{size:40,src:a.avatar}}):e("a-avatar",{staticClass:"avatar",staticStyle:{color:"#f56a00",backgroundColor:"#fde3cf"},attrs:{size:40}},[s._v(" "+s._s(a.userName)+" ")])],1):s._e(),e("div",{staticClass:"message-box"},[a.userId==s.myId?e("div",{staticClass:"read-state"},[e("span",{class:a.isRead?"is-read":"not-read"},[s._v(" "+s._s(a.isRead?"已读":"未读")+" ")])]):s._e(),e("div",{staticClass:"message"},[s._v(" "+s._s(a.message)+" ")])]),a.userId==s.myId?e("div",{staticClass:"avatar"},[null!=a.avatar?e("a-avatar",{staticClass:"avatar",attrs:{size:40,src:a.avatar}}):e("a-avatar",{staticClass:"avatar",staticStyle:{color:"#f56a00",backgroundColor:"#fde3cf"},attrs:{size:40}},[s._v(" "+s._s(a.userName)+" ")])],1):s._e()])})),0)]),e("div",{staticClass:"chat-input"},[s._m(0),e("div",{staticClass:"input"},[e("a-textarea",{attrs:{placeholder:"输入你要说的",rows:4},model:{value:s.value,callback:function(a){s.value=a},expression:"value"}})],1),e("div",{staticClass:"btn"},[e("a-button",{on:{click:s.sendMessage}},[s._v("发送")])],1)])],1):s._e(),null!=s.checkSession.id&&void 0!==s.checkSession.id?e("div",{staticClass:"resume"},[e("div",{staticClass:"resume-info"},[e("vue-scroll",{attrs:{ops:s.ops}},[e("a-col",{staticClass:"x",attrs:{md:24}},[e("a-card",[e("a-col",{attrs:{xs:6,md:3}},[null!=s.resume.user_pic?e("a-avatar",{attrs:{size:64,src:s.resume.user_pic}}):e("a-avatar",{staticStyle:{color:"#f56a00",backgroundColor:"#fde3cf"},attrs:{size:64}},[s._v(" "+s._s(s.resume.api_user_name)+" ")])],1),e("a-col",{attrs:{xs:6,md:21}},[e("div",[s._v(s._s(s.resume.api_user_name))]),e("div",[s._v(s._s(s.resume.api_user_gender)+" | "+s._s(s.$resume.getAge(s.resume.u_birth_date+"-01"))+"岁 | 工作"+s._s(s.resume.rs_wk_year)+"年 | 期望："+s._s(s.resume.u_expect_position)+" | "+s._s(s.resume.u_position_mode)+" | "+s._s(s.resume.rs_salary_range)+" ")])])],1)],1),e("a-col",{staticClass:"x",attrs:{md:24}},[e("a-card",{attrs:{title:"个人期望"}},[e("div",[s._v(" "+s._s(s.resume.u_expect_position)+" | "+s._s(s.resume.u_expect_salary))]),e("div",[s._v(" "+s._s(s.resume.u_expect_place)+" | "+s._s(s.resume.u_position_mode))])])],1),e("a-col",{staticClass:"x",attrs:{md:24}},[e("a-card",{attrs:{title:"工作经历"}},s._l(s.resume.wk,(function(a,t){return e("a-card",{key:t,staticClass:"wk"},[e("div",[e("span",[s._v(s._s(a.wkCompany))]),e("span",[s._v(s._s(a.wkPosition))])]),e("div",[e("span",[s._v(" 当前薪资："+s._s(a.wkSalaryRange)+" ")]),e("span",[s._v(" 在职时间："+s._s(a.wkStartTime)+" - "+s._s(a.wkEndTime)+" ")]),e("span",[s._v(" "+s._s(a.wkMode)+" ")])])])})),1)],1),e("a-col",{staticClass:"x",attrs:{md:24}},[e("a-card",{attrs:{title:"教育经历"}},s._l(s.resume.edu,(function(a,t){return e("a-card",{key:t,staticClass:"wk"},[e("div",[e("span",[s._v(s._s(a.eduSchool)+" | "+s._s(a.eduMajor)+" ")])]),e("div",[s._v(" "+s._s(a.eduStartTime)+" ———— "+s._s(a.eduEndTime)+" | "+s._s(a.eduMode)+" ")])])})),1)],1),e("a-col",{staticClass:"x",attrs:{md:24}},[e("a-card",{attrs:{title:"专业技能"}},[e("div",{staticClass:"hj"},s._l(s.resume.u_professional_skill,(function(a,t){return e("div",[""!=a?e("a-tag",[s._v(" "+s._s(a)+" ")]):s._e()],1)})),0)])],1)],1)],1),e("div",{staticClass:"opt-menu"})]):s._e()])])])},i=[function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"opts"},[e("ul",[e("li",[s._v(" 测试 ")])])])}],r=(e("4ec9"),e("d3b7"),e("3ca3"),e("ddb0"),e("25eb"),e("a9e3"),e("159b"),e("b0c0"),e("25f0"),e("99af"),e("d81d"),e("b775"));function c(s){return Object(r["b"])({url:"/chat/list?pageNo=".concat(s.pageNo,"&pageSize=").concat(s.pageSize),method:"post",data:s})}function n(s){return Object(r["b"])({url:"/chat/get?pageNo=".concat(s.pageNo,"&pageSize=").concat(s.pageSize),method:"post",data:s})}function o(s){return Object(r["b"])({url:"/chat/read",method:"post",data:s})}function d(s){return Object(r["b"])({url:"/chat/resume",method:"post",data:s})}var u={name:"chat.vue",watch:{chatList:function(){}},data:function(){return{userMap:{},resumeMap:{},socketMethod:{},sessionList:[],sessionPage:1,chatList:[],chatMap:{},pageMap:{},updateTimeMap:{},page:{pageNo:1},chatPage:{pageNo:1},checkSession:{},pageSize:40,myId:0,value:"",updateFlag:!0,updateTime:"",resume:{},ops:{vuescroll:{},scrollPanel:{initialScrollY:100},rail:{keepShow:!0},bar:{hoverStyle:!0,onlyShowBarOnScroll:!1,background:"#999",opacity:.5,"overflow-x":"hidden"}},scrollTop:100}},created:function(){this.chatMap=new Map,this.pageMap=new Map,this.updateTimeMap=new Map,this.userMap=new Map,this.resumeMap=new Map;var s=this.$store.state.user;this.myId=Number.parseInt(s.info.tbUserID);var a={name:s.info.nickName,avatar:s.avatar,userId:this.myId};this.userMap.set(this.myId,a);var e=this;this.socketMethod=this.$socket.default.methods,this.socketMethod.initWebSocket(s.info.tbUserID),this.socketMethod.OnMessage((function(s){var a=JSON.parse(s.data);if(1==a.code){var t=a.content;e.handleMessage(t,e)}else 0==a.code&&e.readMessage();e.refresh(e)})),this.getSessionList()},methods:{chatHandleScroll:function(s,a,e){this.scrollTop=s.scrollTop;var t=this;0==this.scrollTop&&this.chatPage.pageNo<this.chatPage.pages&&(this.chatPage.pageNo+=1,this.getChatList().then((function(s){t.$nextTick((function(){}))})))},updateData:function(){var s=this;this.$nextTick((function(){s.$refs.chatList.scrollTo({y:"100%"},0)}))},changeSessionList:function(s){var a=this,e=0,t={},i=this.checkSession.id;this.sessionList.forEach((function(r,c){s.sessionId===r.id&&(r.createTime=a.getTime(s.createTime),r.message=s.message,i!=r.id&&(r.num+=1),e=c,t=r)}));for(var r=e;r>0;r--)this.sessionList[r]=this.sessionList[r-1];this.sessionList[0]=t},refresh:function(s){s.updateFlag=!s.updateFlag},readMessage:function(){var s=this;this.chatList.forEach((function(a,e){if(a.userId==s.myId){var t=a;t.isRead=!0,s.$set(s.chatList,e,t),a.isRead=!0}}))},handleMessage:function(s){var a=this,e=this.checkSession.id,t=a.chatMap.get(e),i=a.userMap.get(s.fromId),r={message:s.message,userId:i.userId,userName:i.name,avatar:i.avatar,type:s.type,isRead:s.isRead};t.push(r),a.changeSessionList(s)},sendMessage:function(){if(""!=this.value){var s=this.userMap.get(this.myId),a={message:this.value,userId:this.myId,userName:s.name,avatar:s.avatar,type:1},e={userId:this.checkSession.userId,code:1,content:{sessionId:this.checkSession.id,message:this.value,type:0}};this.socketMethod.websocketsend(JSON.stringify(e)),this.chatList.push(a),this.checkSession.message=a.message,this.value="",this.updateData()}},checkUser:function(s){if(this.checkSession.userId!=s.userId){this.checkSession=s,s.num=0;var a={name:s.userName,avatar:s.avatar,userId:s.userId},e=this.updateTimeMap.get(s.id);if(null!=e&&void 0!==e){var t=Date.parse(new Date).toString();t=t.substring(0,t.length-3),this.updateTime=t}var i=this,r=[],c={pageNo:1,pages:1},n={};this.chatList=r,this.chatPage=c,this.resume=n,this.userMap.set(a.userId,a);var o=this.chatMap.get(s.id),d=this.pageMap.get(s.id),u=this.resumeMap.get(s.id);null!=o&&void 0!==o&&o.length>0?(this.chatList=o,null!=d&&void 0!==d&&(this.chatPage=d),this.updateData()):this.getChatList(this).then((function(s){i.readChat(),i.updateData()})),null!=u&&void 0!==u?this.resume=u:this.getResume();var h={userId:this.checkSession.userId,code:0,content:{}};this.socketMethod.websocketsend(JSON.stringify(h))}},readChat:function(){var s=this;o({userId:this.myId,sessionId:s.checkSession.id}).then((function(a){s.chatList.forEach((function(a){a.userId==s.myId&&(a.isRead=!0)}))}))},getChatList:function(){var s=this,a=this.checkSession.id,e={sessionId:a,updateTime:this.updateTime,pageSize:this.pageSize,pageNo:this.chatPage.pageNo};return n(e).then((function(e){var t=[];e.data.records.forEach((function(a){var e=s.userMap.get(a.fromId),i={message:a.message,userId:e.userId,userName:e.userName,avatar:e.avatar,type:a.type,isRead:a.isRead};t.push(i)})),s.chatList=t.concat(s.chatList);var i=JSON.parse(JSON.stringify(s.chatList)),r={pageNo:Number.parseInt(e.data.current),pages:e.data.pages};s.chatPage=r,s.chatMap.set(a,i),s.pageMap.set(a,JSON.parse(JSON.stringify(r)))}))},getSessionList:function(){var s=this,a=localStorage.getItem("userOutTime"),e=this.page.pageNo;c({updateTime:a,pageNo:e,pageSize:20}).then((function(a){var e=a.data.records;e.map((function(a){return a.createTime=s.getTime(a.createTime)})),s.sessionList=e,s.sessionPage=a.data.current,e.forEach((function(a){var e=[],t={pageNo:1};s.chatMap.set(a.id,e),s.pageMap.set(a.id,t);var i={userId:a.userId,userName:a.userName,avatar:a.avatar};s.userMap.set(a.userId,i)}));var t={pageNo:a.data.current,total:a.data.pages};s.page=t}))},onSearch:function(s){},getResume:function(){var s=this,a={userId:this.checkSession.userId};d(a).then((function(a){s.resume=a.data,s.resumeMap.set(s.checkSession.id,a.data)}))},getTime:function(s){if(null!==s&&void 0!==s){var a,e=Date.parse(s),t=6e4,i=60*t,r=24*i,c=30*r,n=12*c,o=(new Date).getTime(),d=o-e;if(d<0)return;var u=d/n,h=d/r,l=d/i,p=d/t;return a=u>=1?s.substring(0,10):h>=2?s.substring(5,10):h>=1?parseInt(h)+"天前":l>=1?parseInt(l)+"小时前":p>=1?parseInt(p)+"分钟前":"刚刚",a}return""}}},h=u,l=(e("1471"),e("2877")),p=Object(l["a"])(h,t,i,!1,null,"83725d1e",null);a["default"]=p.exports}}]);